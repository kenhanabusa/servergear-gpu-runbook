#!/usr/bin/env bash
set -euo pipefail
BASE_DIR="$(cd "$(dirname "$0")" && pwd)"
SAMPLE_DIR="$BASE_DIR/sample"
URL="https://notes.server-gear.com/assets/downloads/qe_llzo96_300k_inputs_20260211.zip"

mkdir -p "$SAMPLE_DIR"
tmp="$(mktemp)"
echo "[fetch] $URL"
if command -v curl >/dev/null 2>&1; then
  curl -fsSL "$URL" -o "$tmp"
elif command -v wget >/dev/null 2>&1; then
  wget -qO "$tmp" "$URL"
else
  echo "ERROR: need curl or wget" >&2
  exit 40
fi

# zipは share_public/qe_llzo96_300k_inputs_.../ に入っている想定
if command -v unzip >/dev/null 2>&1; then
  unzip -oq "$tmp" -d "$SAMPLE_DIR/.tmp_qe"
else
  echo "ERROR: need unzip" >&2
  exit 40
fi

# 中のディレクトリを探して中身だけ移す
inner="$(find "$SAMPLE_DIR/.tmp_qe" -maxdepth 2 -type f -name 'llzo96_scf_300k.in' -print -quit | sed 's#/llzo96_scf_300k.in##')"
if [ -z "${inner:-}" ]; then
  echo "ERROR: unexpected zip layout" >&2
  exit 40
fi

cp -a "$inner"/llzo96_scf_300k.in "$SAMPLE_DIR/llzo96_scf_300k.in"
cp -a "$inner"/llzo96_aimd_300k.in "$SAMPLE_DIR/llzo96_aimd_300k.in" 2>/dev/null || true
echo "OK: placed QE sample into $SAMPLE_DIR"
rm -rf "$SAMPLE_DIR/.tmp_qe" "$tmp"
